---
title: "shapes"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{geometries}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#"
)
```

```{r setup }
library(geometries)
library(Rcpp)
```

The shape headers are in

```r
#include "geometries/shapes/shapes.hpp"
```

Including this header will give you all the functions for creating 'shapes' from matrices and data.frames.

- `geometries::shapes::to_vec()` - creates a vector
- `geometries::shapes::to_mat()` - creates a matrix

All these examples show you how to include the header and call the functions using Rcpp code. The same principles apply in a .cpp file in a package.


### Lines

```{r}

df <- data.frame(
  x = 1:10
  , y = 10:1
  , z = 21:30
  , m = 30:21
  , val = letters[1:10]
  , id = c( rep(1,5), rep(2,5) )
)

df

library(Rcpp)

cppFunction(
  depends = "geometries"
  , includes = '#include "geometries/shapes/shapes.hpp"'
  , code = '
    SEXP line( SEXP df, SEXP geometry_cols ) {
      return geometries::shapes::to_mat( df, geometry_cols );
    }
  '
)

line( df, c("x","y") )
```

### Polygon

```{r}

cppFunction(
  depends = "geometries"
  , includes = '#include "geometries/shapes/shapes.hpp"'
  , code = '
    SEXP polygon( DataFrame df, IntegerVector id_cols, IntegerVector geometry_cols, Rcpp::StringVector class_attribute ) {
      return geometries::shapes::make_geometry( df, id_cols, geometry_cols, class_attribute );
    }
  '
)

polygon( df, c(5), c(0,1,2), "my_line")
polygon( df, c(5), c(0,1,2), "my_polygon")

res <- polygon( df, c(5), c(0,1,2), c("XYZ", "POLYGON","sfg") )

```


### MultiPolygon

```{r}
cppFunction(
  depends = "geometries"
  , includes = '#include "geometries/shapes/shapes.hpp"'
  , code = '
    SEXP multipolygon( SEXP df, SEXP geometry_cols, SEXP polygon_id, SEXP line_id ) {
      return geometries::shapes::to_listListMat( df, geometry_cols, polygon_id, line_id );
    }
  '
)

multipolygon( df, c("x","y"), c("id"),  c("id") )

```


